# 压力测试文档

### 压力测试原理

我们选择使用Jmeter工具进行单元测试，Jmeter会自动建立线程组，线程组自动建立指定数目的线程，每个线程都向指定url发送http请求，并迭代我们选定的次数。最终Jmeter将返回结果输出，并可以自动生成可视化图表。

**Jmeter的GUI界面**

![image-20200726141504241](%E5%8E%8B%E5%8A%9B%E6%B5%8B%E8%AF%95%E6%96%87%E6%A1%A3.assets/image-20200726141504241.png)

### 压力测试参数设置

**设置线程组参数**

![image-20200726143317469](%E5%8E%8B%E5%8A%9B%E6%B5%8B%E8%AF%95%E6%96%87%E6%A1%A3.assets/image-20200726143317469.png)

**http请求设置**

![image-20200726173304194](%E5%8E%8B%E5%8A%9B%E6%B5%8B%E8%AF%95%E6%96%87%E6%A1%A3.assets/image-20200726173304194.png)

在http请求设置中，我们发现并没有设置Port端口号，这是因为我们已经使用nginx将/back-end映射到8080端口，只需要访问/back-end下的api即可实现对服务器上后端的访问。

**基本参数设置如下**

numbers of threads(users)(*线程数*)：500

Ramp-up period(seconds)(*启动所有线程时间*)：5

Loop-Count(*循环次数*)：5

表示将在5秒内启动500个线程且每个线程循环5次

**http请求设置如下**

url：https:dolo.club/back-end/api/student/course_valid?startIndex=1&pageSize=10

method：Get

其中startIndex的参数含义为生成1到10000区间内的随机数，pageSize表示每页有10个数据，两个参数均用于分页查询

### 压力测试结果

![image-20200726165547343](%E5%8E%8B%E5%8A%9B%E6%B5%8B%E8%AF%95%E6%96%87%E6%A1%A3.assets/image-20200726165547343.png)

可视化结果树的效果如下：所有http请求正常发送并且接受到了正确的结果

![image-20200726204959312](%E5%8E%8B%E5%8A%9B%E6%B5%8B%E8%AF%95%E6%96%87%E6%A1%A3.assets/image-20200726204959312.png)

平均响应时间为1.615秒

为了使测试更加准确，避免误差，重新设置发送参数，本次测试中startIndex使用随机数生成，保证测试的随机性。再次测试结果如下

![image-20200726143236889](%E5%8E%8B%E5%8A%9B%E6%B5%8B%E8%AF%95%E6%96%87%E6%A1%A3.assets/image-20200726143236889.png)

得到的结果如下

![image-20200726204917617](%E5%8E%8B%E5%8A%9B%E6%B5%8B%E8%AF%95%E6%96%87%E6%A1%A3.assets/image-20200726204917617.png)

平均响应时间变长，可能是因为网络原因，CDN加速不够稳定导致访问速度波动较大。

### 压力测试结论与优化方法

我们的目标是在500并发的访问量下能够达到2秒以内的响应时间，现在的压力测试仅针对后端接口，由于网络稳定性不足以及没有与前端连接，现在的响应时间仍不能达到我们的要求。所以我们打算用如下方法增加系统的稳定性和鲁棒性

1、采用分布式数据库，针对不同的服务采用不同的数据库存储结构和存储方式，提高访问效率。

2、服务器的访问使用CDN加速，提高网络稳定性及提高访问速度。

3、采用微服务架构，并用kubernetes托管，实现弹性布局与负载均衡，提高系统的访问速度与并发量。

